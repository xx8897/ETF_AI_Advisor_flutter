# 專案成果與進度紀錄 (Project Log)

本文檔記錄了「ETF主題式智能理財顧問」專案截至當前時間點的開發成果、遭遇的挑戰、核心技術解析以及未來的操作指南。

## 一、 當前專案狀態

**專案已完成所有核心功能的開發，並成功在本機環境中運行。**

- **前端介面**: 已透過 `app.py` (Streamlit) 建立完整的使用者互動介面。
- **後端邏輯**: 已透過 `core_logic.py` 實現 RAG (检索增强生成) 的所有核心功能。
- **資料庫**: 已透過 `build_vector_db.py` 成功建立並填充了 `chroma_db` 向量資料庫。
- **AI 核心**: 系統能成功根據使用者選擇的主題，動態生成包含**資產配置比例 (allocation)** 在內的投資分析報告。

## 二、 環境設定與挑戰 (`PATH` 問題)

在部署與測試階段，我們遇到了典型的環境變數 `PATH` 設定問題。

1.  **初步問題**: 直接執行 `streamlit run app.py` 失敗，系統回報找不到 `streamlit` 指令。
2.  **原因分析**:
    *   `pip` 在安裝套件時，因權限不足，將可執行檔 (如 `streamlit.exe`) 安裝至**使用者級別**的 `Scripts` 目錄，而非系統級別的目錄。
    *   此使用者級別的 `Scripts` 目錄路徑並未包含在作業系統的 `PATH` 環境變數中。
3.  **解決方案**:
    *   **精準定位路徑**: 透過 `python -m site` 指令，我們精準地找到了使用者級別 `Scripts` 的實際路徑為：`C:\Users\xx8897\AppData\Roaming\Python\Python313\Scripts`。
    *   **手動新增 PATH**: 使用者已成功將此正確路徑手動新增至 Windows 的環境變數中。
    *   **立即啟動方式**: 在 `PATH` 更新於新終端機生效前，我們採用 `python -m streamlit run app.py` 的指令格式來確保應用能立即啟動。

## 三、 核心技術解析：`allocation` 是如何計算的？

專案中最關鍵的**資產配置比例 (`allocation`)** 並非由固定的數學公式或程式碼邏輯計算，而是由**大型語言模型 (LLM) - OpenAI GPT-4o** 動態生成的。

**運作流程如下：**

1.  **使用者輸入**: 使用者在前端介面選擇感興趣的投資主題 (如 "高股息", "科技/半導體")。
2.  **資料檢索 (Retrieval)**: 系統根據主題，從 `chroma_db` 向量資料庫中檢索出最相關的 ETF 資料文件。
3.  **指令生成 (Prompt Engineering)**: `core_logic.py` 會將使用者主題、檢索到的 ETF 資料，以及一份精心設計的指令稿 (Prompt) 打包。
4.  **LLM 分析與決策**:
    *   該指令稿會要求 LLM 扮演一位**專業的 ETF 投資顧問**。
    *   LLM 會被指示，根據提供的資料，推薦 2-3 檔 ETF，並**決定各檔的配置比例**，同時確保總和為 100%。
    *   LLM 在決策時會模擬人類專家的思維，可能考量**風險平衡、主題權重、成分股重疊度**等因素。
5.  **結構化輸出**: LLM 最終會以嚴格的 JSON 格式回傳包含 `allocation` 在內的完整分析報告。

此流程的實現依賴於使用者在 `.env` 檔案中提供的 `OPENAI_API_KEY`。

## 四、 如何在本機成功運行應用程式

根據我們的除錯經驗，以下是在您本機環境成功運行此專案的最可靠步驟：

1.  **開啟命令提示字元 (CMD) 或 PowerShell**。
2.  **切換至專案目錄**:
    ```cmd
    cd C:\Users\xx8897\codespace\gemini_cli\project\etf_adviser
    ```
3.  **(推薦) 直接執行指令**:
    由於您已修正 `PATH` 環境變數，在新開啟的終端機中，可以直接使用以下指令：
    ```cmd
    streamlit run app.py
    ```
4.  **(備用) 兼容指令**:
    如果因任何原因上一條指令無效，可以使用以下保證能運作的指令：
    ```cmd
    python -m streamlit run app.py
    ```
5.  **回應 Email 提示 (若出現)**:
    *   首次運行時，終端機可能會出現 `Email:` 的提示。
    *   您可以直接按 `Enter` 跳過，或輸入您的 Email 後按 `Enter`。
6.  **在瀏覽器中開啟**:
    *   成功啟動後，終端機會顯示可供存取的本地網址。
    *   請在瀏覽器中開啟該網址 (通常是 `http://localhost:8501`) 來操作應用程式。

---
*文件由 AI 專案經理生成*
